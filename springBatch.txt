import org.springframework.batch.core.Job;
import org.springframework.batch.core.JobExecution;
import org.springframework.batch.core.JobLauncher;
import org.springframework.batch.core.JobParameter;
import org.springframework.batch.core.JobParameters;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.HashMap;
import java.util.Map;

@RestController
public class JobLauncherController {
    @Autowired
    private JobLauncher jobLauncher;

    @Autowired
    private Job job;

    @Autowired
    private JobConfigService jobConfigService;

    @PostMapping("/jobLauncher")
    public void handle(@RequestParam("configId") String configId) throws Exception {
        Map<String, JobParameter> jobParameters = createJobParam(configId);
        JobExecution jobExecution = jobLauncher.run(job, new JobParameters(jobParameters));
        // Handle the job execution result as needed
    }

    private Map<String, JobParameter> createJobParam(String configId) {
        Map<String, Object> jobConfig = jobConfigService.getJobConfig(configId);
        Map<String, JobParameter> jobParameters = new HashMap<>();
        jobConfig.forEach((key, value) -> jobParameters.put(key, new JobParameter(value.toString())));
        return jobParameters;
    }
}
